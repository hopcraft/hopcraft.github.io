!function(e){function a(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,a),i.l=!0,i.exports}var t={};a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},a.p="",a(a.s=1)}([function(e,a){function t(e,a){return a=void 0==a?1:a?1:-1,function(t,s){return t=t[e],s=s[e],t<s?-1*a:t>s?1*a:0}}function s(e,a){for(var t=0;t<e.length;t++)if(e[t]==a){e.splice(t,1);break}}function i(e,a){for(var t=e.length;t--;)if(e[t]===a)return!0;return!1}function n(e){"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?(document.addEventListener("WeixinJSBridgeReady",function(){e.play()},!1),document.addEventListener("YixinJSBridgeReady",function(){e.play()},!1)):e.play()}function o(e,a,t,s,i){e=game.add.button(t,s,a,null,this),e.anchor.set(.5),e.onInputDown.add(function(){game.add.tween(e.scale).to({x:.99,y:.99},100,Phaser.Easing.Linear.None,!0,0)},this),e.onInputUp.add(function(){game.add.tween(e.scale).to({x:1,y:1},100,Phaser.Easing.Linear.None,!0,0).onComplete.add(i)},this)}function g(e,a){switch(this.x=70,this.y=300+70*a,game.buffArc=game.add.image(this.x+90,this.y,"buff_arc"),game.buffArc.fixedToCamera=!0,game.buffArc.anchor.set(.5),game.buffName=game.add.text(-50,-20,"燕澜七缙为您：",{font:"18px Arial",fill:"#f60",align:"left"}),game.buffArc.addChild(game.buffName),game.buffText=game.add.text(-50,5,game.buffDataJson[e].text,{font:"18px Arial",fill:"#ffffff",align:"left"}),game.buffArc.addChild(game.buffText),game.buffKuang=game.add.image(this.x,this.y,"buff_kuang"),game.buffKuang.anchor.set(.5),game.buffKuang.fixedToCamera=!0,game.add.tween(game.buffKuang).to({angle:360},1500,Phaser.Easing.Linear.None,!0,0,-1,!1),game.bico=game.add.image(this.x,this.y,"b_"+e),game.bico.fixedToCamera=!0,game.bico.anchor.set(.5),e){case 0:game.monsterDataJson.forEach(function(a){a.Drop+=game.buffDataJson[e].eff});break;case 1:game.playerDataJson.move_speed+=game.buffDataJson[e].eff;break;case 2:game.playerDataJson.attack_speed+=game.buffDataJson[e].eff;break;case 3:game.monsterDataJson.forEach(function(a){a.HP-=game.buffDataJson[e].eff});break;case 4:game.monsterDataJson.forEach(function(a){a.SPEED-=game.buffDataJson[e].eff});break;case 5:game.playerDataJson.power+=game.buffDataJson[e].eff;break;case 6:game.monsterDataJson.forEach(function(e){e.SCORE+=1})}}function r(e,a,t){$.ajax({url:e,type:"POST",data:a,dataType:"json",success:t})}var m={init:function(e){game.kards=game.add.group();for(var a=0;a<4;a++)game.kard=game.add.button(200+250*a,35,"k_"+a,e,this),game.ss=game.add.image(0,game.kard.height+85,"ss"),game.ss.anchor.set(0,1),game.sel=game.add.image(game.ss.centerX,-40,"sel_0"),game.sel.scale.x=game.sel.scale.y=1.8,game.sel.anchor.set(.5),game.ss.addChild(game.sel),game.kard.addChild(game.ss),game.kard.id=game.kard.key.split("_")[1],game.kard.scale.x=game.kard.scale.y=.53,game.kards.add(game.kard);for(var t=0;t<3;t++)game.kard=game.add.button(200+250*t,395,"k_"+(t+4),e,this),game.ss=game.add.image(0,game.kard.height+85,"ss"),game.ss.anchor.set(0,1),game.sel=game.add.image(game.ss.centerX,-40,"sel_0"),game.sel.scale.x=game.sel.scale.y=1.8,game.sel.anchor.set(.5),game.ss.addChild(game.sel),game.kard.addChild(game.ss),game.kard.id=game.kard.key.split("_")[1],game.kard.scale.x=game.kard.scale.y=.53,game.kards.add(game.kard)},showSelect:function(e){game.kards.forEach(function(e){e.children[0].children[0].loadTexture("sel_0")}),e.forEach(function(e){game.kards.children[e].children[0].children[0].loadTexture("sel_1")})}},l={init:function(e){game.kardBig=game.add.image(0,0,"Kard_big"),game.closeKardBig=game.add.button(game.world.width-20,20,"close_btn",function(){l.hide()},this),game.kard=game.add.image(150,100),game.skillText=game.add.text(881,405,null,{font:"30px Arial",fill:"#bae4f5",align:"center"}),game.skillText.anchor.set(.5,.5),game.closeKardBig.anchor.set(1,0),game.notSelectText=game.add.text(681,505,"您最多选择3张卡牌，\n可以取消之前的选择更换卡牌！",{font:"30px Arial",fill:"#bae4f5",align:"left"}),game.notSelectText.visible=!1,game.confirm=game.add.button(750,520,"confirm",function(e){e.select?s(selectKard,e.id):(selectKard.push(e.id),e.select=!0),l.hide(),m.showSelect(selectKard)},this),game.kardBig.addChild(game.closeKardBig),game.kardBig.addChild(game.kard),game.kardBig.addChild(game.skillText),game.kardBig.addChild(game.confirm),game.kardBig.addChild(game.notSelectText),game.kardBig.visible=!1},show:function(e,a){game.skillText.setText(a),game.kard.loadTexture("k_"+e,0,!1),game.kardBig.visible=!0,game.selectOK.inputEnabled=!1,game.confirm.id=e,selectKard.length>=3?(game.confirm.visible=!1,game.notSelectText.visible=!0):game.confirm.visible=!0,i(selectKard,e)?(game.confirm.select=!0,game.confirm.loadTexture("cancel"),game.notSelectText.visible=!1,game.confirm.visible=!0):(game.confirm.select=!1,game.confirm.loadTexture("confirm")),game.kards.setAll("inputEnabled",!1)},hide:function(){game.kardBig.visible=!1,game.selectOK.inputEnabled=!0,game.kards.setAll("inputEnabled",!0)}},d={init:function(){game.tip=game.add.sprite(game.world.width+500,150,"tip"),game.tip.fixedToCamera=!0,game.propText=game.add.text(game.tip.width/2,game.tip.height/2+3,"123123123",{font:"18px Arial",fill:"#ffffff",align:"center"}),game.propText.anchor.set(.5),game.tip.addChild(game.propText)},show:function(e){game.propText.setText(e),game.add.tween(game.tip.cameraOffset).to({x:350},500,Phaser.Easing.Cubic.Out,!0,0).onComplete.add(function(){game.add.tween(game.tip.cameraOffset).to({x:game.world.width+500},500,Phaser.Easing.Cubic.In,!0,2500)})}};e.exports={sortBy:t,playerAudio:n,addBtn:o,bigKard:l,kards:m,defaultBuff:g,tip:d,getData:r}},function(e,a,t){t(2),t(4),t(5),t(6),t(7),t(8),t(9),t(10),t(11),t(12),t(13),t(14);var s=document.getElementById("game-box");Phaser.myScaleManager=new MyScaleManager(s),game=new Phaser.Game(1206,750,Phaser.CANVAS,"game-box"),Phaser.myScaleManager.boot(),game.state.add("Boot",MyGame.Boot),game.state.add("Preloader",MyGame.Preloader),game.state.add("MainMenu",MyGame.MainMenu),game.state.add("Home",MyGame.Home),game.state.add("Kard",MyGame.Kard),game.state.add("Game",MyGame.Game),game.state.add("Result",MyGame.Result),game.state.add("Rank",MyGame.Rank),game.state.start("Boot")},function(e,a,t){utils=t(0),api=t(3),WebFontConfig={google:{families:["Revalia"]}},MyGame.Boot=function(e){},MyGame.Boot.prototype={init:function(){this.input.maxPointers=2,this.stage.disableVisibilityChange=!0,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,game.physics.startSystem(Phaser.Physics.ARCADE)},preload:function(){this.load.image("loadingBar_1","../assets/loadingBar_1.png"),this.load.image("loadingBar_0","../assets/loadingBar_0.png")},create:function(){game.state.start("Preloader")}}},function(e,a){var t={getKey:host+"/project/wx/2017/07/api/index.php?s=/Index/refInfo",hascrm:host+"/project/wx/2017/07/api/index.php?s=/Index/getUser",postcrm:host+"/project/wx/2017/07/api/index.php?s=/Index/saveUser",postscore:host+"/project/wx/2017/07/api/index.php?s=/Index/saveGame",rank:host+"/project/wx/2017/07/api/index.php?s=/Index/rank",help:host+"/project/wx/2017/07/api/index.php?s=/Index/getHelp"};e.exports={url:t}},function(e,a){MyGame.Preloader=function(e){},MyGame.Preloader.prototype={preload:function(){this.loadBar=this.add.group(),this.loadBar.create(0,0,"loadingBar_0"),this.preloadBar=this.loadBar.create(2,2,"loadingBar_1"),this.load.setPreloadSprite(this.preloadBar),this.loadBar.x=game.world.width/2-150,this.loadBar.y=game.world.height/2,$.fn.cookie("user")&&(user=JSON.parse($.fn.cookie("user")),game.load.image("my_headImg",user.head_img)),game.load.script("webfont","https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js"),game.load.audio("biu","../assets/music/biu.mp3?123123",!0);for(var e=1;e<6;e++)game.load.audio("kill_"+e,"../assets/music/kill_"+e+".mp3?111",!0);game.load.image("rule_btn","../assets/rule_btn.jpg?123"),game.load.image("rule","../assets/rule.png?1231234"),game.load.image("MainMenu_bg","../assets/MainMenu_bg.jpg?123123"),game.load.image("MainMenu_logo","../assets/MainMenu_logo.png"),game.load.image("MainMenu_pep","../assets/MainMenu_pep.png"),game.load.image("MainMenu_startBtn","../assets/MainMenu_startBtn.png"),game.load.image("Home_bg","../assets/Home_bg.jpg"),game.load.image("ranking_btn","../assets/ranking_btn.png"),game.load.image("buff_btn","../assets/buff_btn.png"),game.load.image("Home_startBtn_bg","../assets/Home_startBtn_bg.png"),game.load.image("Home_pep","../assets/Home_pep.png"),game.load.image("Home_startBtn","../assets/Home_startBtn.png"),game.load.image("Home_kuang","../assets/Home_kuang.png?123"),game.load.image("add","../assets/add.jpg"),game.load.image("Kard_bg","../assets/Kard_bg.jpg"),game.load.image("Kard_big","../assets/kard_big.png"),game.load.image("close_btn","../assets/close_btn.png");for(var e=0;e<7;e++)game.load.image("k_"+e,"../assets/k_"+e+".png?2");game.load.image("ss","../assets/ss.png"),game.load.image("select_ok","../assets/select_ok.png"),game.load.image("sel_0","../assets/sel_0.png"),game.load.image("sel_1","../assets/sel_1.png"),game.load.image("confirm","../assets/confirm.png"),game.load.image("cancel","../assets/cancel.png"),game.load.image("bg","../assets/game_bg.jpg"),game.load.image("bullet","../assets/jian_skin2.png?123"),game.load.image("player","../assets/player.png"),game.load.atlas("monster_101","../assets/monster_json/monster_101.png","../assets/monster_json/monster_101.json"),game.load.atlas("monster_201","../assets/monster_json/monster_201.png","../assets/monster_json/monster_201.json"),game.load.atlas("monster_301","../assets/monster_json/monster_301.png","../assets/monster_json/monster_301.json"),game.load.image("buff_kuang","../assets/buff_kuang.png");for(var e=0;e<7;e++)game.load.image("b_"+e,"../assets/b_"+e+".png");game.load.image("buff_arc","../assets/buff_arc.png");for(var e=0;e<3;e++)game.load.image("skill_"+e,"../assets/skill_"+e+".png");game.load.image("tip","../assets/tip.png"),game.load.image("score_box","../assets/score_box.png"),game.load.image("life_box","../assets/life_box.png"),game.load.image("clear_btn","../assets/clear.png?123123111"),game.load.image("result_bg","../assets/Result_bg.jpg?1"),game.load.image("replay_btn","../assets/replay_btn.png"),game.load.image("myrank_btn","../assets/myrank_btn.png"),game.load.image("xuanyao_btn","../assets/xuanyao_btn.png"),game.load.image("rank_bg","../assets/Rank_bg.jpg"),game.load.image("back_btn","../assets/back_btn.png"),game.load.image("rank_warp_1","../assets/rank_warp_1.png"),game.load.image("rank_warp_2","../assets/rank_warp_2.png");for(var e=0;e<5;e++)game.load.image("r_"+e,"../assets/r_"+e+".png");game.load.image("tx_warp_1","../assets/tx_warp_1.png"),game.load.image("jiangbei","../assets/jiangbei.png"),game.load.image("quan","../assets/quan.png?1"),game.load.json("player_data","../cfg/player_data.json?3"),game.load.json("monster_data","../cfg/monster_data.json?3"),game.load.json("level_data","../cfg/level_data.json?3"),game.load.json("buff_data","../cfg/buff_data.json?3"),game.load.json("prop_data","../cfg/prop_data.json?3"),this.load.image("compass","../assets/compass_rose.png"),this.load.image("touch_segment","../assets/touch_segment.png"),this.load.image("touch","../assets/touch.png"),game.load.image("zhi","../assets/zhi.png?123")},create:function(){game.state.start("MainMenu")}}},function(e,a){MyGame.MainMenu=function(){},MyGame.MainMenu.prototype={init:function(){},preload:function(){},create:function(){game.add.image(0,0,"MainMenu_bg"),game.ruleBtn=game.add.button(game.world.width-50,50,"rule_btn",function(){game.rule.visible=!0},this),game.ruleBtn.anchor.set(1,0),game.pep=game.add.sprite(game.world.centerX+30,game.world.height+10,"MainMenu_pep"),game.pep.anchor.set(.5,1),game.add.tween(game.pep).to({y:game.world.height},1500,Phaser.Easing.Linear.None,!0,0,-1,!0),game.logo=game.add.sprite(game.world.centerX,30,"MainMenu_logo"),game.logo.anchor.set(.5,0),game.add.tween(game.logo.scale).from({x:7,y:7},800,Phaser.Easing.Cubic.In,!0,300).onComplete.add(function(){game.add.tween(game.logo.scale).to({x:-1},200,Phaser.Easing.Linear.None,!0,0,0,!0)}),game.add.tween(game.logo).from({alpha:0},800,Phaser.Easing.Cubic.In,!0,300),utils.addBtn(game.startBtn,"MainMenu_startBtn",game.world.centerX,game.world.height-100,function(){game.state.start("Home")}),game.rule=game.add.image(0,0,"rule"),game.rule.visible=!1,game.rule.inputEnabled=!0,game.rule.input.priorityID=1,game.rule.input.useHandCursor=!0,game.rule.events.onInputDown.add(function(){game.rule.visible=!1},this)},update:function(){}}},function(e,a){MyGame.Home=function(e){},friend=0;var t;MyGame.Home.prototype={create:function(){t=this,game.add.image(0,0,"Home_bg"),game.startBtnBg=game.add.image(200,40,"Home_startBtn_bg"),game.HomePep=game.add.image(315,game.startBtnBg.height-7,"Home_pep"),game.HomePep.anchor.set(.5,1),game.startBtnBg.addChild(game.HomePep),game.add.tween(game.HomePep.scale).to({y:.98},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0);for(var e=0;e<selectKard.length;e++)game.kard=game.add.image(212+225*e,210,"k_"+selectKard[e]),game.kard.scale.x=game.kard.scale.y=.6;utils.addBtn(game.rankBtn,"Home_startBtn",546,630,function(){game.state.start("Game")}),utils.addBtn(game.rankBtn,"ranking_btn",game.world.width-170,game.world.height-172,function(){alert("单机版排行榜功能已经屏蔽")}),utils.addBtn(game.rankBtn,"buff_btn",game.world.width-170,242,function(){game.state.start("Kard")}),game.helps=game.add.group();for(var e=0;e<3;e++)game.helper=game.add.image(50,280+145*e,"add"),game.helps.add(game.helper);for(var e=0;e<3;e++)game.kuang=game.add.image(50,280+145*e,"Home_kuang");game.helps.setAll("inputEnabled",!0),game.helps.callAll("events.onInputDown.add","events.onInputDown",function(){alert("单机版助战功能已经屏蔽")}),game.zhi=game.add.image(0,0,"zhi"),game.zhi.visible=!1,game.zhi.inputEnabled=!0,game.zhi.input.priorityID=1,game.zhi.input.useHandCursor=!0,game.zhi.events.onInputDown.add(function(){game.zhi.visible=!1},this)},update:function(){}}},function(e,a){MyGame.Kard=function(e){},MyGame.Kard.prototype={create:function(){game.buffDataJson=game.cache.getJSON("buff_data"),game.add.image(0,0,"Kard_bg"),utils.kards.init(this.fangda),utils.kards.showSelect(selectKard),game.selectOK=game.add.button(game.world.width-110,game.world.height-20,"select_ok",function(){game.state.start("Home")},this),game.selectOK.anchor.set(1,1),utils.bigKard.init()},update:function(){},fangda:function(e){utils.bigKard.show(e.id,game.buffDataJson[e.id].text)}}},function(e,a,t){var s=t(0);MyGame.Game=function(e){e.bulletTime=0};var i;MyGame.Game.prototype={create:function(){i=this,game.biu=game.add.audio("biu"),game.kill1=game.add.audio("kill_1"),game.kill2=game.add.audio("kill_2"),game.kill3=game.add.audio("kill_3"),game.kill4=game.add.audio("kill_4"),game.kill5=game.add.audio("kill_5"),game.kill1_play=!1,game.kill2_play=!1,game.kill3_play=!1,game.kill4_play=!1,game.kill5_play=!1,this.game.touchControl=this.game.plugins.add(Phaser.Plugin.TouchControl),this.game.touchControl.inputEnable(),this.game.touchControl.speed.x=this.game.touchControl.speed.y=0,game.levelState={level:1,sheaves:1},game.score=0,game.levelDataJson=game.cache.getJSON("level_data"),game.playerDataJson=game.cache.getJSON("player_data"),game.monsterDataJson=game.cache.getJSON("monster_data"),game.propDataJson=game.cache.getJSON("prop_data"),game.playerDataJson.life+=friend,game.allLife=game.playerDataJson.life,this.add.tileSprite(0,0,1500,1500,"bg"),this.world.setBounds(0,0,1500,1500),game.monsters=game.add.group(),game.socreBox=game.add.image(1020,20,"score_box"),game.socreBox.anchor.set(.5,0),game.socreBox.fixedToCamera=!0,game.socreText=game.add.text(10,38,"0",{font:"30px",fill:"#91d7ff",align:"center"}),game.socreText.anchor.set(.5),game.socreBox.addChild(game.socreText),game.lifeBox=game.add.image(700,20,"life_box"),game.lifeBox.anchor.set(.5,0),game.lifeBox.fixedToCamera=!0,game.lifeText=game.add.text(10,38,game.playerDataJson.life+"/"+game.allLife,{font:"30px",fill:"#91d7ff",align:"center"}),game.lifeText.anchor.set(.5),game.lifeBox.addChild(game.lifeText),game.props=game.add.group(),game.weapon=new Weapon(this.game),game.player=new Player(game),game.add.existing(game.player),selectKard.forEach(function(e,a){s.defaultBuff(Number(e),a)}),this.createMonster(game.levelState.level,game.levelState.sheaves),s.tip.init(),s.tip.show("敌军即将进入战场，请做好准备！"),game.clearBtn=game.add.button(950,500,"clear_btn",function(){game.monsters.forEach(function(e){e.inCamera&&e.dead()}),game.camera.flash(16777215,1e3),game.clearBtn.kill()},this),game.clearBtn.fixedToCamera=!0},update:function(){if(game.player.isDead)return void(game.player.body.velocity.x=game.player.body.velocity.y=0);game.player.body.velocity.x=-this.game.touchControl.speed.x*game.playerDataJson.move_speed/100,game.player.body.velocity.y=-this.game.touchControl.speed.y*game.playerDataJson.move_speed/100,game.monsters.children.sort(s.sortBy("displayer")),game.monsters.children[0].inCamera&&!game.end&&(game.player.rotation=game.physics.arcade.angleBetween(game.player,game.monsters.children[0]),game.time.time>game.bulletTime&&(game.weapon.fire(game.player,game.player.angle,1500,game.playerDataJson.weapon_type),game.biu.play(),game.bulletTime=game.time.time+(1e3-game.playerDataJson.attack_speed))),game.physics.arcade.overlap(game.player,game.monsters,null,this.hitMonster,this),game.physics.arcade.overlap(game.weapon.children,game.monsters,null,this.shootMonster,this),game.physics.arcade.overlap(game.player,game.props,null,this.pickupProp,this)},createMonster:function(e,a){game.levelDataJson[e-1].enemy[a-1].forEach(function(a){game.monster=new Monster(game,a,e),game.monsterId+=1,game.monster.id=game.monsterId,game.add.existing(game.monster),game.monsters.add(game.monster)})},hitMonster:function(e){game.playerDataJson.life--,game.lifeText.setText(game.playerDataJson.life+"/"+game.allLife),e.dead(game.playerDataJson.life)},shootMonster:function(e,a){e.kill(),a.cutHp(game.playerDataJson.power)},pickupProp:function(e,a){game.player.pickupProp(e,a)},render:function(){}}},function(e,a){MyGame.Result=function(e){},MyGame.Result.prototype={create:function(){game.add.image(0,0,"result_bg"),game.resulScoreText=game.add.text(300,230,"您获得了 "+game.score+" 分",{font:"40px",fill:"#eab904",align:"center"}),game.resulScoreText.anchor.set(.5,0),utils.addBtn(game.replayBtn,"replay_btn",180,400,function(){game.state.start("Home")}),utils.addBtn(game.myrankBtn,"myrank_btn",450,400,function(){alert("功能已屏蔽")}),utils.addBtn(game.xuanyaoBtn,"xuanyao_btn",300,560,function(){alert("功能已屏蔽")}),game.zhi=game.add.image(0,0,"zhi"),game.zhi.visible=!1,game.zhi.inputEnabled=!0,game.zhi.input.priorityID=1,game.zhi.input.useHandCursor=!0,game.zhi.events.onInputDown.add(function(){game.zhi.visible=!1},this)},update:function(){}}},function(e,a){MyGame.Rank=function(e){};var t;MyGame.Rank.prototype={create:function(){t=this,game.add.image(0,0,"rank_bg"),utils.addBtn(game.backBtn,"back_btn",70,37,function(){game.state.start("Home")}),game.ranks=game.add.group(),game.myTx=game.add.image(970,40,"my_headImg"),game.myTx.width=200,game.myTx.height=200,game.myTx.anchor.set(.5,0),game.myName=game.add.text(960,310,user.nick_name,{font:"40px",fill:"#b89039",align:"center"}),game.myName.anchor.set(.5,0),game.myRank=game.add.text(820,375,"",{font:"26px",fill:"#ffffff",align:"left"}),game.myscore=game.add.text(820,430,"",{font:"26px",fill:"#ffffff",align:"left"}),game.jiangbei=game.add.image(970,580,"jiangbei"),game.jiangbei.anchor.set(.5),game.jiangbei.inputEnabled=!0,game.jiangbei.events.onInputDown.add(function(){game.quan.visible=!0},this),game.add.tween(game.jiangbei.scale).to({x:.95,y:.95},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0),utils.getData(api.url.rank,{openid:user.openid},function(e){e.status?(game.myRank.setText("最高排行："+e.rank),game.myscore.setText("最高分数："+e.topScore),t.createRank(e.data)):alert(e.msg)}),game.quan=game.add.image(game.world.centerX,game.world.centerY,"quan"),game.quan.anchor.set(.5),game.quan.visible=!1,game.quan.inputEnabled=!0,game.quan.events.onInputDown.add(function(){game.quan.visible=!1},this)},update:function(){},createRank:function(e){e.forEach(function(e,a){if(0==a)var t="rank_warp_1",s="#c7a45b";else var t="rank_warp_2",s="#bdbdbc";game.rank=game.add.image(60,100+125*a,t),game.rankName=game.add.text(160,45,e.nick_name,{font:"24px",fill:s,align:"left"}),game.rankIco=game.add.image(75,58,"r_"+a),game.rankIco.anchor.set(.5),game.rankScore=game.add.text(600,65,e.score,{font:"34px",fill:s,align:"right"}),game.rankScore.anchor.set(1,.5),game.rank.addChild(game.rankName),game.rank.addChild(game.rankIco),game.rank.addChild(game.rankScore),game.ranks.add(game.rank)})}}},function(e,a){UI=function(e){},UI.prototype=Object.create(Phaser.Sprite.prototype),UI.prototype.constructor=UI,UI.prototype.pop=function(){var e=game.add.sprite(200,200,"player");e.anchor.set(.5),e.fixedToCamera=!0,game.add.tween(e.scale).from({y:0,x:0},2e3,Phaser.Easing.Bounce.In,!0)}},function(e,a){Player=function(e){Phaser.Sprite.call(this,e,game.world.centerX,game.world.centerY,"player"),this.anchor.set(.5),game.physics.enable(this,Phaser.Physics.ARCADE),this.body.setSize(this.width/2,this.height/2,this.width/4,this.height/4),this.scale.x=this.scale.y=.5,this.body.immovable=!0,this.body.collideWorldBounds=!0,game.camera.follow(this),this.isDead=!1,this.getprop=!1,this.body.velocity.x=this.body.velocity.y=0},Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player,Player.prototype.dead=function(e){var a=this;this.isDead=!0,this.body.enable=!1,this.body.velocity.x=this.body.velocity.y=0,this.deadAni=game.add.tween(this).to({alpha:.3},800,Phaser.Easing.Linear.None,!0,0,-1,!0),game.monsters.forEach(function(e){e.body.velocity.x=e.body.velocity.y=0}),e<=0?(game.playerDataJson.life=1,utils.tip.show("你死了！没有复活次数了！"),game.time.events.add(3*Phaser.Timer.SECOND,function(){game.world.setBounds(0,0,1206,750),game.state.start("Result")},this)):(utils.tip.show("你死了！还有："+e+" 次复活,5秒钟后复活！"),game.time.events.add(5*Phaser.Timer.SECOND,function(){a.revive()},this))},Player.prototype.update=function(){},Player.prototype.revive=function(){utils.tip.show("您复活了！加油吧，争取得到更高分数~"),this.isDead=!1,this.body.enable=!0,this.alpha=1,this.deadAni.pause(),game.monsters.forEach(function(e){var a=game.rnd.between(0,3);e.reset(e.way[a].x,e.way[a].y)})},Player.prototype.say=function(e){e=e||"默认文字",this.say=game.add.text(0,-this.x,e,{font:"60px Arial",fill:"#ff0044"}),this.say.anchor.set(.5,1),this.addChild(this.say)},Player.prototype.pickupProp=function(e,a){a.destroy(),this.getprop=!0,this.getprop&&this.useProp(a.id)},Player.prototype.useProp=function(e){switch(utils.tip.show("燕澜七缙为您 "+game.propDataJson[e].text),e){case 0:game.playerDataJson.weapon_type+game.propDataJson[e].eff>=5?(game.playerDataJson.weapon_type=5,utils.tip.show("超过箭数量最大值，不能获得加成！")):game.playerDataJson.weapon_type+=game.propDataJson[e].eff;break;case 1:game.playerDataJson.attack_speed+game.propDataJson[e].eff>900?game.playerDataJson.attack_speed=900:game.playerDataJson.attack_speed+=game.propDataJson[e].eff;break;case 2:game.playerDataJson.move_speed+game.propDataJson[e].eff>500?(game.playerDataJson.move_speed=500,utils.tip.show("超过移动速度最大值，不能获得加成！")):game.playerDataJson.move_speed+=game.propDataJson[e].eff}this.getprop=!1}},function(e,a){Monster=function(e,a,t){this.monster=game.monsterDataJson[a-1],game.difficulty=game.levelDataJson[t-1].difficulty,this.way=[{x:game.rnd.realInRange(-100,-500),y:game.rnd.realInRange(-100,game.world.height+500)},{x:game.rnd.realInRange(game.world.width+100,game.world.width+500),y:game.rnd.realInRange(-100,game.world.height+500)},{x:game.rnd.realInRange(-100,game.world.width+500),y:game.rnd.realInRange(-100,-500)},{x:game.rnd.realInRange(-100,game.world.width+500),y:game.rnd.realInRange(game.world.height+100,game.world.height+500)}];var s=game.rnd.between(0,3);Phaser.Sprite.call(this,e,this.way[s].x,this.way[s].y,"monster_"+this.monster.resId),game.physics.enable(this,Phaser.Physics.ARCADE),this.body.setSize(this.width/2,this.height/2,this.width/4,this.height/4),this.animations.add("run",Phaser.Animation.generateFrameNames("monster"+this.monster.resId+"_run_",0,2,"",4),3,!0),this.animations.play("run"),this.anchor.set(.5),this.x_dir=1,this.y_dir=1,this.displayer=null,this.isHit=!1,this.speed=this.monster.SPEED*game.difficulty,this.hp=this.monster.HP*game.difficulty,this.score=parseInt(this.monster.SCORE*game.difficulty),this.drop=this.monster.Drop},Monster.prototype=Object.create(Phaser.Sprite.prototype),Monster.prototype.constructor=Monster,Monster.prototype.update=function(){game.player.isDead||(this.displayer=Math.sqrt(Math.abs(game.player.x-this.x)*Math.abs(game.player.x-this.x)+Math.abs(game.player.y-this.y)*Math.abs(game.player.y-this.y)),this.isHit?this.tint=16711680:this.tint=16777215,this.isHit=!1,parseInt(this.x)>=parseInt(game.player.x-game.player.width/2+20)&&parseInt(this.x)<=parseInt(game.player.x+game.player.width/2-20)?this.body.velocity.x=0:(parseInt(this.x)>parseInt(game.player.x)?this.x_dir=-1:this.x_dir=1,this.body.velocity.x=this.speed*this.x_dir),parseInt(this.y)>=parseInt(game.player.y-game.player.height/2+50)&&parseInt(this.y)<=parseInt(game.player.y+game.player.height/2-50)?this.body.velocity.y=0:(parseInt(this.y)>parseInt(game.player.y)?this.y_dir=-1:this.y_dir=1,this.body.velocity.y=this.speed*this.y_dir),this.rotation=game.physics.arcade.angleBetween(this,game.player))},Monster.prototype.cutHp=function(e){this.isHit=!0,this.inWorld&&(this.hp-=e,this.hp<=0&&this.dead())},Monster.prototype.dead=function(){var e=this;this.body.enable=!1,game.score+=Number(parseInt(this.score)),game.score>1e4&&!game.kill1_play?(game.kill1.play(),game.kill1_play=!0):game.score>5e4&&!game.kill2_play?(game.kill2.play(),game.kill2_play=!0):game.score>1e5&&!game.kill3_play?(game.kill3.play(),game.kill3_play=!0):game.score>2e5&&!game.kill4_play?(game.kill4.play(),game.kill4_play=!0):game.score>5e5&&!game.kill5_play&&(game.kill5.play(),game.kill5_play=!0),game.socreText.setText(game.score),game.add.tween(e).to({alpha:0},500,Phaser.Easing.Linear.None,!0,500).onComplete.add(function(){if(e.destroy(),e.currentRnd=100*Math.random(),e.currentRnd<=e.drop){game.prop=game.add.sprite(e.x,e.y),game.physics.enable(game.prop,Phaser.Physics.ARCADE),game.prop.anchor.set(.5),game.props.add(game.prop);var a=100*Math.random();a<=game.propDataJson[0].odd?(game.prop.loadTexture("skill_0"),game.prop.id=0):a>game.propDataJson[0].odd&&a<=game.propDataJson[1].odd?(game.prop.loadTexture("skill_1"),game.prop.id=1):(game.prop.loadTexture("skill_2"),game.prop.id=2)}game.monsters.countLiving()<=0&&(game.levelState.sheaves>=game.levelDataJson[game.levelState.level-1].enemy.length?(game.levelState.level>=game.levelDataJson.length?(game.levelState={level:1,sheaves:1},game.levelDataJson.forEach(function(e){e.difficulty*=1.5}),utils.tip.show("你激怒了大陆领主，怪物能力骤然提升！")):(game.levelState.level++,game.levelState.sheaves=1),game.canAttack=!1):game.levelState.sheaves++,game.levelDataJson[game.levelState.level-1].enemy[game.levelState.sheaves-1].forEach(function(e){game.monster=new Monster(game,e,game.levelState.level),game.add.existing(game.monster),game.monsters.add(game.monster)}))})}},function(e,a){var t=function(e,a){Phaser.Sprite.call(this,e,0,0,a),this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this.anchor.set(.5),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.exists=!1,this.tracking=!1,this.scaleSpeed=0};t.prototype=Object.create(Phaser.Sprite.prototype),t.prototype.constructor=t,t.prototype.fire=function(e,a,t,s,i,n){i=i||0,n=n||0,this.reset(e,a),this.scale.set(1),this.game.physics.arcade.velocityFromAngle(t,s,this.body.velocity),this.angle=t,this.body.gravity.set(i,n)},t.prototype.update=function(){},Weapon=function(e){Phaser.Group.call(this,e,e.world,"Single Bullet",!1,!0,Phaser.Physics.ARCADE);for(var a=0;a<150;a++)this.add(new t(e,"bullet"),!0);return this},Weapon.prototype=Object.create(Phaser.Group.prototype),Weapon.prototype.constructor=Weapon,Weapon.prototype.fire=function(e,a,t,s){var i=e.x,n=e.y+6.5;switch(s){case 1:this.getFirstExists(!1).fire(i,n,0+a,t,0,0);break;case 2:this.getFirstExists(!1).fire(i,n,-5+a,t,0,0),this.getFirstExists(!1).fire(i,n,5+a,t,0,0);break;case 3:this.getFirstExists(!1).fire(i,n,-10+a,t,0,0),this.getFirstExists(!1).fire(i,n,0+a,t,0,0),this.getFirstExists(!1).fire(i,n,10+a,t,0,0);break;case 4:this.getFirstExists(!1).fire(i,n,-15+a,t,0,0),this.getFirstExists(!1).fire(i,n,-5+a,t,0,0),this.getFirstExists(!1).fire(i,n,5+a,t,0,0),this.getFirstExists(!1).fire(i,n,15+a,t,0,0);break;case 5:this.getFirstExists(!1).fire(i,n,-20+a,t,0,0),this.getFirstExists(!1).fire(i,n,-10+a,t,0,0),this.getFirstExists(!1).fire(i,n,0+a,t,0,0),this.getFirstExists(!1).fire(i,n,10+a,t,0,0),this.getFirstExists(!1).fire(i,n,20+a,t,0,0)}}}]);